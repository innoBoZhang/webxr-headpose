<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>WebXR Head Pose Viewer</title>
  <style>
    body {
      font-family: sans-serif;
      background: #111;
      color: #0f0;
      padding: 2em;
      line-height: 1.5em;
    }
    button {
      font-size: 1.2em;
      padding: 1em 2em;
      margin-bottom: 1em;
      border: none;
      cursor: pointer;
    }
    #enter-vr {
      background: #0f0;
      color: #000;
    }
    #exit-vr {
      background: red;
      color: #fff;
      display: none;
    }
    pre {
      background: #222;
      padding: 1em;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <button id="enter-vr">Enter VR</button>
  <button id="exit-vr">Exit VR</button>
  <pre id="output">Waiting to start XR session...</pre>

  <script>
    let xrSession = null;
    let xrRefSpace = null;
    let gl = null;

    const enterBtn = document.getElementById("enter-vr");
    const exitBtn = document.getElementById("exit-vr");
    const output = document.getElementById("output");

    enterBtn.addEventListener("click", async () => {
      if (!navigator.xr) {
        output.textContent = "WebXR not supported.";
        return;
      }

      const supported = await navigator.xr.isSessionSupported('immersive-vr');
      if (!supported) {
        output.textContent = "Immersive VR not supported.";
        return;
      }

      try {
        xrSession = await navigator.xr.requestSession('immersive-vr');
        const canvas = document.createElement('canvas');
        gl = canvas.getContext('webgl', { xrCompatible: true });

        await gl.makeXRCompatible();
        await xrSession.updateRenderState({
          baseLayer: new XRWebGLLayer(xrSession, gl)
        });

        xrRefSpace = await xrSession.requestReferenceSpace('local');
        xrSession.requestAnimationFrame(onXRFrame);

        enterBtn.style.display = 'none';
        exitBtn.style.display = 'inline';

        xrSession.addEventListener("end", () => {
          output.textContent += "\nSession ended.";
          enterBtn.style.display = 'inline';
          exitBtn.style.display = 'none';
        });

      } catch (e) {
        output.textContent = "Failed to start XR session: " + e;
      }
    });

    exitBtn.addEventListener("click", () => {
      if (xrSession) {
        xrSession.end();
      }
    });

    function onXRFrame(time, frame) {
      const session = frame.session;
      session.requestAnimationFrame(onXRFrame);

      const pose = frame.getViewerPose(xrRefSpace);
      if (pose) {
        const view = pose.views[0];
        const pos = view.transform.position;
        const ori = view.transform.orientation;

        output.textContent = `
Head Pose Data:

Position (meters):
  x: ${pos.x.toFixed(3)}
  y: ${pos.y.toFixed(3)}
  z: ${pos.z.toFixed(3)}

Orientation (quaternion):
  x: ${ori.x.toFixed(3)}
  y: ${ori.y.toFixed(3)}
  z: ${ori.z.toFixed(3)}
  w: ${ori.w.toFixed(3)}
        `;
      }
    }
  </script>
</body>
</html>
